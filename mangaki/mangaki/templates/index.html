{% extends "base.html" %}
{% load staticfiles %}
{% load posters %}

{% block body %}
{% load account socialaccount %}

{% get_providers as socialaccount_providers %}
<div class="row featured text-center">
    <h1>Mangaki, la recommandation d'anime et manga</h1>
</div>

<h2>Notez vos anime et mangas favoris…</h2>
<div id="works" class="row">    
    <div class="col-xs-12 cards-grid">
        <card v-for="(work, index) in works" v-bind:work="work" :key="work.id">
            <rating v-for="(rating, index) in ratings" v-bind:rating="rating" v-bind:work="work" :key="rating.id"></rating>
        </card>
    </div>
</div>

<h2>… et découvrez vos <a href="{% url 'reco' %}">recommandations</a> !</h2>
<div class="row featured">
  <div style="width: 80%; margin: auto;">
    <h2 class="col-xs-12" style="font-size: 1.9em; margin-top: 0; text-align: center;">
        Dernières nouveautés
    </h2>
    <a class="twitter-timeline" data-height="400"
      href="https://twitter.com/MangakiFR">
    Tweets by @MangakiFR
    </a>
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
  </div>
</div>

<div class="partners row">
	{% for partner in partners %}
    <div class="col-xs-6 col-sm-4 col-md-2">
        <a href="http://{{ partner.url }}" target="_blank" title="{{ partner.name }}"><img  src="/static/img/sponsors/small/{{ partner.image }}" /></a>
	</div>
	{% endfor %}
</div>

<br />
<br />
<br />
{% endblock %}

{% block extrajs %}
{% static 'img/ratings.svg' as rating_svg_link %}
<script>
Vue.component('card', {
  delimiters: ['#{', '}'],
  props: ['work'],
  template: `
    <div class="work-card work-card_horizontal">
        <div class="work-card__media work-cover work-cover_backdrop" :style="{'background-image': 'url(' + work.poster + ')'}">
            <div class="work-cover__wrapper" :data-category="work.category">
                <div class="work-cover__title">
                    <h2 class="work-card__title">#{work.title}</h2>
                </div>
                <div class="work-cover__content">
                <div class="work-card__content">
                    <div class="work-card__synopsis">
                        #{work.synopsis}
                    </div>
                    <a :href="'/' + work.category + '/' + work.id" class="work-card__link">
                        Plus d'infos…
                    </a>
                </div>
                </div>
            </div>
        </div>
        <div class="ratings ratings_medium" data-endpoint="">
            <slot></slot>
        </div>
    </div>
  `
});

Vue.component('rating', {
  delimiters: ['#{', '}'],
  props: ['rating', 'work'],
  template: `
    <label :class="['rating', 'rating_' + rating.name, (rating.name == 'willsee') ? 'rating_separator' : '']" :title="rating.title">
      <span class="sr-only">#{rating.title}</span>
      <input
        type="checkbox"
        :name="'rating[' + work.id + ']'"
        :value="rating.name"
        class="rating__checkbox">
      <span class="rating__button">
        <svg class="rating__icon">
          <use :xlink:href="'{{ rating_svg_link }}#' + rating.name"></use>
        </svg>
      </span>
    </label>
  `
})

new Vue({
  delimiters: ['${', '}'],
  el: '#works',
  data: {
    works: [
      // {id: 1, title: 'Death Note', category: 'anime', synopsis: 'Super', poster: '', nsfw: false},
    ],
    ratings: [
      {name: 'favorite', title: "J'adore"},
      {name: 'like', title: "J'aime"},
      {name: 'neutral', title: "Neutre"},
      {name: 'dislike', title: "Je déteste"},
      {name: 'willsee', title: "J'ai envie de voir"},
      {name: 'wontsee', title: "Je n'ai pas envie de voir"}
    ]
  },
  methods: {
    init() {
      $.getJSON('/api/cards/anime/dpp', works => this.works = works);
      $.getJSON('/api/cards/manga/dpp', works => works.forEach(work => this.works.push(work)));
    }
  },
  mounted() {
    this.init()
  }
})
</script>
{% endblock %}
