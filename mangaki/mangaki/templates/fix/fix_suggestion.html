{% extends "base.html" %}
{% load staticfiles %}
{% load posters %}

{% block title %}Suggestion #{{ suggestion.pk }} - Mangaki{% endblock %}

{% block body %}

<h1>Suggestion #{{ suggestion.pk }}</h1><br/>

<div class="container">
<div class="row">

    <div class="col-sm-4 col-md-3" align="center">
        <div class="work-sheet data" data-category="{{ suggestion.work.category__slug }}" data-id="{{ suggestion.work.id }}">
            {% include "mangaki/work_rating.html" with category=suggestion.work.category__slug work=suggestion.work config=config simple=True %}
        </div>
    </div>

    <div class="col-sm-8 col-md-9">
        <br/>
        <div class="row">
        <div class="col-md-push-1 col-sm-push-1 col-lg-10 col-sm-10">
            <div class="input-group">
                <span class="input-group-addon" id="basic-addon2">
                    <span class="glyphicon glyphicon-link"></span> Lien de partage
                </span>
                <input type="text" class="form-control" value="{{ request.build_absolute_uri }}">
            </div>
            <form>
        </div>
        </div>
        <br/>

        <div class="well">
            <p>
                <h4><strong>Problème&nbsp;:</strong>
                    {{ suggestion.get_problem_display }}
                </h4>
            </p>
            <p>
                <h5><strong>Envoyé par&nbsp;:</strong>
                    <a href="{% url "profile" suggestion.user %}">{{ suggestion.user }}</a>
                    <small>({{ suggestion.date }})</small>
                </h5>
            </p>
            {% if suggestion.message %}
            <hr/>
            <p class="text-muted">{{ suggestion.message }}</p>
            {% endif %}
            {% if related_cluster %}
            <hr/>
            <p><strong>Doublon de&nbsp;:</strong></p>
            {% for work in related_cluster %}
            <p align="center">
                {% if work != suggestion.work %}
                    <div class="work-sheet data" data-category="{{ work.category|lower }}" data-id="{{ work.id }}" style="float: left; margin-right: 12px;">
                    <div class="work-card work-card_horizontal" style="width: 190px; height: 283px;">
                    <div class="work-card__media work-cover" style="background-image: url('{% poster_url work %}');">
                        <div class="work-cover__wrapper" data-category="{{ work.category|lower }}">
                            <div class="work-cover__title">
                                <h2 class="work-card__title" style="font-size: 1.3em;">
                                    {{ work.title|truncatechars:50 }}
                                </h2>
                            </div>
                        </div>
                    </div>
                    </div>
                    </div>
                {% endif %}
            </p>
            {% endfor %}
            {% endif %}
            <hr style="clear: both;"/>
            <p align="right">
                Approuvez-vous cette suggestion&nbsp;?&nbsp;
                <input type="checkbox" name="agrees" data-suggestion="{{ suggestion.pk }}" {% if evidence.agrees %}checked{% endif %} />
            </p>
            <p align="right">
                Demander de l'aide à un administrateur&nbsp;?&nbsp;
                <input type="checkbox" name="needs_help" data-suggestion="{{ suggestion.pk }}" {% if evidence.needs_help %}checked{% endif %} />
            </p>
        </div>
    </div>
</div>

<hr/>

<nav aria-label="Navigation dans les suggestions de fix">
    <ul class="pager">
        <li class="previous {% if not previous_id %} disabled {% endif %}">
            <a href="{% if previous_id %} {% url "fix-suggestion" previous_id %} {% else %} # {% endif %}">
                <span aria-hidden="true">&larr;</span> Précédent
            </a>
        </li>
        <li>
            <a href="/fix/">Retour</a>
        </li>
        <li class="next {% if not next_id %} disabled {% endif %}">
            <a href="{% if next_id %} {% url "fix-suggestion" next_id %} {% else %} # {% endif %}">
                Suivant <span aria-hidden="true">&rarr;</span>
            </a>
        </li>
    </ul>
</nav>
</div>

{% endblock %}

{% block extrajs %}
<script>
    $.fn.bootstrapSwitch.defaults.size = 'mini';
    $.fn.bootstrapSwitch.defaults.onText = 'OUI';
    $.fn.bootstrapSwitch.defaults.offText = 'NON';
    $.fn.bootstrapSwitch.defaults.onColor = 'success';
    $.fn.bootstrapSwitch.defaults.offColor = 'danger';

    $("[name='agrees']").bootstrapSwitch();
    $("[name='agrees']").on('switchChange.bootstrapSwitch', function (event, state) {
        $.post(Urls['update-evidence'](), {agrees: state, suggestion: $(this).data("suggestion")});
    });

    $("[name='needs_help']").bootstrapSwitch();
    $("[name='needs_help']").on('switchChange.bootstrapSwitch', function (event, state) {
        $.post(Urls['update-evidence'](), {needs_help: state, suggestion: $(this).data("suggestion")});
    });
</script>
{% endblock %}
